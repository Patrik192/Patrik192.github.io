<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="description" content="Официальный тренажёр слепой печати СПб ГБПОУ «МК им.В.М.Бехтерева»">
<meta name="author" content="СПб ГБПОУ «МК им.В.М.Бехтерева»">
<meta name="theme-color" content="#0e585c">
<title>Тренажёр слепой печати</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}
body {
  background: linear-gradient(135deg, #0e585c 0%, #0e585c 100%);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding: 20px;
}
.page-title {
  background: #0e585c;
  border-radius: 20px;
  padding: 15px 30px;
  color: #fff;
  font-size: 30px;
  text-align: center;
  max-width: 1800px;
  width: 100%;
  margin: 0 auto 20px;
}
.container {
  background: white;
  border-radius: 20px;
  padding: 30px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  max-width: 900px;
  width: 100%;
  height: auto;
  max-height: 100%;
}
.stats {
  display: flex;
  justify-content: space-around;
  margin-bottom: 20px;
  gap: 15px;
  flex-wrap: wrap;
}
.stat-box {
  text-align: center;
  padding: 5px;
  background: #f8f9fa;
  border-radius: 10px;
  min-width: 100px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}
.stat-box h3 {
  font-size: 12px;
  color: #6c757d;
  margin-bottom: 3px;
}
.stat-box .value {
  font-size: 28px;
  font-weight: bold;
  color: #333;
}
.text-display {
  background: #f8f9fa;
  padding: 15px;
  border-radius: 10px;
  margin-bottom: 20px;
  min-height: 150px;
  line-height: 1.6;
  font-size: 18px;
  overflow-y: auto;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  position: relative;
}
.text-display span {
  position: relative;
}
.text-display span.current {
  background: #e3f2fd;
  border-radius: 3px;
  box-shadow: 0 0 8px rgba(102, 126, 234, 0.5);
}
.text-display span.correct {
  color: #28a745;
}
.text-display span.incorrect {
  color: #dc3545;
  text-decoration: underline wavy red;
}
.input-area {
  margin-top: 15px;
  margin-bottom: 15px;
}
#typing-input {
  width: 100%;
  padding: 12px;
  font-size: 16px;
  border: 2px solid #ddd;
  border-radius: 8px;
  outline: none;
  transition: border-color 0.3s;
  text-align: center;
}
#typing-input:focus {
  border-color: #667eea;
}
.controls {
  display: flex;
  gap: 10px;
  margin-top: 15px;
  margin-bottom: 15px;
  flex-wrap: wrap;
  align-items: center;
  justify-content: center;
}
.btn {
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s;
  font-weight: 600;
  white-space: nowrap;
}
.btn-primary {
  background: #667eea;
  color: white;
}
.btn-primary:hover {
  #5568d3;
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
}
.btn-secondary {
  background: #6c757d;
  color: white;
}
.btn-secondary:hover {
  background: #5a6268;
}
.btn-outline {
  background: transparent;
  border: 2px solid #667eea;
  color: #667eea;
}
.btn-outline.active {
  background: #667eea;
  color: white;
}
.btn-outline:hover:not(.active) {
  background: #667eea;
  color: white;
}
.difficulty-selector, .text-mode-selector {
  display: flex;
  gap: 8px;
  align-items: center;
  flex-wrap: wrap;
}
.difficulty-btn, .mode-btn {
  padding: 6px 12px;
  border: 2px solid #ddd;
  background: white;
  border-radius: 5px;
  cursor: pointer;
  transition: all 0.3s;
  font-size: 13px;
}
.difficulty-btn.active, .mode-btn.active {
  background: #667eea;
  color: white;
  border-color: #667eea;
}
.progress-bar {
  height: 6px;
  background: #e9ecef;
  border-radius: 3px;
  margin-top: 15px;
  margin-bottom: 15px;
  overflow: hidden;
}
.progress {
  height: 100%;
  background: #28a745;
  transition: width 0.3s;
}
.result-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.7);
  z-index: 1000;
  justify-content: center;
  align-items: center;
}
.result-content {
  background: white;
  padding: 30px;
  border-radius: 20px;
  max-width: 500px;
  width: 90%;
  text-align: center;
}
.result-content h2 {
  margin-bottom: 20px;
  color: #333;
  font-size: 24px;
}
.result-stats {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 15px;
  margin: 25px 0;
}
.result-stat {
  padding: 15px;
  background: #f8f9fa;
  border-radius: 10px;
}
.result-stat .label {
  font-size: 12px;
  color: #6c757d;
  margin-bottom: 3px;
}
.result-stat .value {
  font-size: 28px;
  font-weight: bold;
  color: #333;
}
.keyboard-hint {
  margin-top: 15px;
  padding: 12px;
  background: #5f9394;
  border-radius: 8px;
  border-left: 4px solid #0e585c;
  font-size: 14px;
  color: #ffffff;
}
.custom-text-area {
  margin-top: 15px;
  margin-bottom: 15px;
  display: none;
}
.custom-text-area textarea {
  width: 100%;
  min-height: 100px;
  padding: 12px;
  font-size: 14px;
  border: 2px solid #ddd;
  border-radius: 8px;
  resize: vertical;
  font-family: inherit;
  line-height: 1.6;
}
.custom-text-area textarea:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
}
.custom-text-actions {
  display: flex;
  gap: 8px;
  margin-top: 8px;
  justify-content: flex-end;
}
.custom-text-actions .btn {
  padding: 6px 12px;
  font-size: 13px;
}
.mode-selector-container {
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 15px;
  flex-wrap: wrap;
}
/* Virtual Keyboard Styles - ИСПРАВЛЕНА СТРУКТУРА */
.virtual-keyboard {
  background: #2c2c2c;
  border-radius: 12px;
  padding: 10px;
  margin-top: 20px;
  box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
  display: flex;
  flex-direction: column;
  gap: 6px;
  position: relative;
}
.key-row {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  position: relative;
}
.key {
  flex: 1 0 20px;
  min-width: 40px;
  max-width: 100%;
  background: #444;
  color: white;
  border: none;
  border-radius: 6px;
  padding: 10px 6px;
  font-size: 14px;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: default;
  user-select: none;
  transition: all 0.2s;
  position: relative;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
}
.key:active {
  transform: translateY(2px);
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}
.key-space {
  flex: 0 0 300px;
}
.key-tab {
  flex: 0 0 60px;
}
.key-caps {
  flex: 0 0 80px;
}
.key-enter {
  flex: 0 0 80px;
  height: 84px;
  position: absolute;
  right: 0;
  top: 0;
  z-index: 2;
}
.key-enter2 {
  flex: 0 0 70px;
  color: Transparent;
  background: #2c2c2c;
  box-shadow: 0 0px 0px rgba(0, 0, 0, 0);
}
.key-shiftl {
  flex: 0 0 60px;
}
.key-shiftr {
  flex: 0 0 160px;
}
.key-backspace {
  flex: 0 0 100px;
}
.key-ctrl {
  flex: 0 0 80px;
}
.key-alt {
  flex: 0 0 60px;
}
.key-menu {
  flex: 0 0 40px;
}
.key-win {
  flex: 0 0 60px;
}
.key-aly {
  flex: 0 0 60px;
  color: Transparent;
  background: #2c2c2c;
}
/* Key highlights */
.key.current {
  background: #667eea;
  box-shadow: 0 0 15px rgba(102, 126, 234, 0.8);
  transform: scale(1.05);
  color: white !important;
}
.key.correct {
  background: #28a745;
  box-shadow: 0 0 12px rgba(40, 167, 69, 0.6);
  color: white !important;
}
.key.incorrect {
  background: #dc3545;
  box-shadow: 0 0 12px rgba(220, 53, 69, 0.6);
  color: white !important;
}
.key.pressed {
  background: #555;
  transform: translateY(2px);
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
}
@media (max-width: 768px) {
  .container {
    padding: 15px;
    max-height: 85vh;
  }
  .stats {
    flex-direction: column;
    gap: 10px;
  }
  .stat-box {
    min-width: 100%;
    padding: 10px;
  }
  .stat-box .value {
    font-size: 24px;
  }
  .text-display {
    font-size: 16px;
    padding: 15px;
    min-height: 120px;
  }
  .btn {
    flex: 1;
    min-width: 100px;
    padding: 8px 16px;
    font-size: 13px;
  }
  .controls {
    flex-direction: column;
    align-items: stretch;
  }
  .mode-selector-container {
    flex-direction: column;
    align-items: stretch;
  }
  .custom-text-actions {
    justify-content: stretch;
    flex-direction: column;
  }
  .custom-text-actions .btn {
    flex: 1;
  }
  .key {
    padding: 8px 4px;
    font-size: 12px;
  }
  .key-space {
    flex: 0 0 220px;
  }
  .key-tab, .key-caps, .key-enter, .key-shift, .key-backspace, .key-ctrl, .key-alt, .key-win {
    flex: 0 0 80px;
  }
  .key-enter {
    height: 40px;
  }
  .virtual-keyboard {
    padding: 15px;
    gap: 3px;
  }
}
@media (max-width: 480px) {
  .key {
    padding: 6px 2px;
    font-size: 10px;
  }
  .key-space {
    flex: 0 0 160px;
  }
  .virtual-keyboard {
    padding: 10px;
  }
  .mode-selector-container, .difficulty-selector, .text-mode-selector {
    flex-direction: column;
    align-items: flex-start;
  }
}
</style>
</head>
<body>
<header class="page-header">
  <h1 class="page-title">Тренажёр слепой печати СПб ГБПОУ «МК им.В.М.Бехтерева»</h1>
</header>
<div class="container">
  <div class="stats">
    <div class="stat-box">
      <h3>Скорость</h3>
      <div class="value" id="cpm">0</div>
      <small>симв/мин</small>
    </div>
    <div class="stat-box">
      <h3>Точность</h3>
      <div class="value" id="accuracy">100%</div>
    </div>
    <div class="stat-box">
      <h3>Ошибки</h3>
      <div class="value" id="errors">0</div>
    </div>
    <div class="stat-box">
      <h3>Время</h3>
      <div class="value" id="timer">0s</div>
    </div>
  </div>
  <div class="mode-selector-container">
    <div class="text-mode-selector">
      <span>Режим:</span>
      <button class="mode-btn active" data-mode="random">Случайный текст</button>
      <button class="mode-btn" data-mode="custom">Свой текст</button>
    </div>
    <div class="difficulty-selector">
      <span>Сложность:</span>
      <button class="difficulty-btn active" data-difficulty="easy">Легко</button>
      <button class="difficulty-btn" data-difficulty="medium">Средне</button>
      <button class="difficulty-btn" data-difficulty="hard">Сложно</button>
    </div>
  </div>
  <div class="custom-text-area" id="custom-text-area">
    <textarea id="custom-text-input" placeholder="Введите или вставьте свой текст здесь...">Кошка спит на мягком диване у окна. Её мурлыканье успокаивает.</textarea>
    <div class="custom-text-actions">
      <button class="btn btn-secondary" id="clear-custom-btn">Очистить</button>
      <button class="btn btn-primary" id="use-custom-btn">Использовать этот текст</button>
    </div>
  </div>
  <div class="text-display" id="text-display"></div>
  <div class="progress-bar">
    <div class="progress" id="progress"></div>
  </div>
  <div class="input-area">
    <input type="text" id="typing-input" placeholder="Начните печатать..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  </div>
  <div class="controls">
    <button class="btn btn-primary" id="start-btn">Начать</button>
    <button class="btn btn-secondary" id="reset-btn">Сбросить</button>
    <button class="btn btn-outline" id="keyboard-toggle-btn">Скрыть клавиатуру</button>
  </div>
  <div class="keyboard-hint">
    <strong>Совет:</strong> Держите пальцы на домашней позиции (ФЫВА ОЛДЖ) и используйте все пальцы для печати.
  </div>
  <!-- ИСПРАВЛЕННАЯ СТРУКТУРА КЛАВИАТУРЫ -->
  <div class="virtual-keyboard" id="virtual-keyboard">
    <!-- Row 1 -->
    <div class="key-row">
      <div class="key">ё</div>
      <div class="key">1</div>
      <div class="key">2</div>
      <div class="key">3</div>
      <div class="key">4</div>
      <div class="key">5</div>
      <div class="key">6</div>
      <div class="key">7</div>
      <div class="key">8</div>
      <div class="key">9</div>
      <div class="key">0</div>
      <div class="key">-</div>
      <div class="key">=</div>
      <div class="key key-backspace">⌫</div>
    </div>
    
    <!-- Row 2 -->
    <div class="key-row">
      <div class="key key-tab">⇥</div>
      <div class="key">й</div>
      <div class="key">ц</div>
      <div class="key">у</div>
      <div class="key">к</div>
      <div class="key">е</div>
      <div class="key">н</div>
      <div class="key">г</div>
      <div class="key">ш</div>
      <div class="key">щ</div>
      <div class="key">з</div>
      <div class="key">х</div>
      <div class="key">ъ</div>
	  <div class="key key-enter">↵</div>
	  <div class="key key-enter">↵ Enter</div>
    </div>
    
    <!-- Row 3 -->
    <div class="key-row">
      <div class="key key-caps">⇪</div>
      <div class="key">ф</div>
      <div class="key">ы</div>
      <div class="key">в</div>
      <div class="key">а</div>
      <div class="key">п</div>
      <div class="key">р</div>
      <div class="key">о</div>
      <div class="key">л</div>
      <div class="key">д</div>
      <div class="key">ж</div>
      <div class="key">э</div>
      <div class="key">\</div>
	  <div class="key key-aly">Aly</div>
    </div>
    
    <!-- Row 4 -->
    <div class="key-row">
      <div class="key key-shiftl">⇧</div>
	  <div class="key">\</div>
      <div class="key">я</div>
      <div class="key">ч</div>
      <div class="key">с</div>
      <div class="key">м</div>
      <div class="key">и</div>
      <div class="key">т</div>
      <div class="key">ь</div>
      <div class="key">б</div>
      <div class="key">ю</div>
      <div class="key">.</div>
      <div class="key key-shiftr">⇧ Shift</div>
    </div>
    
    <!-- Row 5 -->
    <div class="key-row">
      <div class="key key-ctrl">Ctrl</div>
      <div class="key key-win">⊞</div>
      <div class="key key-alt">Alt</div>
      <div class="key key-space"></div>
      <div class="key key-alt">Alt</div>
      <div class="key key-win">⊞</div>
	  <div class="key key-menu">▤</div>
      <div class="key key-ctrl">Ctrl</div>
    </div>
  </div>
</div>
<div class="result-modal" id="result-modal">
  <div class="result-content">
    <h2>Тренировка завершена!</h2>
    <div class="result-stats">
      <div class="result-stat">
        <div class="label">Скорость</div>
        <div class="value" id="result-cpm">0</div>
      </div>
      <div class="result-stat">
        <div class="label">Точность</div>
        <div class="value" id="result-accuracy">0%</div>
      </div>
      <div class="result-stat">
        <div class="label">Ошибки</div>
        <div class="value" id="result-errors">0</div>
      </div>
      <div class="result-stat">
        <div class="label">Время</div>
        <div class="value" id="result-time">0s</div>
      </div>
    </div>
    <button class="btn btn-primary" id="restart-btn">Начать заново</button>
  </div>
</div>
<script>
class TypingTrainer {
  constructor() {
    this.textDisplay = document.getElementById('text-display');
    this.typingInput = document.getElementById('typing-input');
    this.cpmDisplay = document.getElementById('cpm');
    this.accuracyDisplay = document.getElementById('accuracy');
    this.errorsDisplay = document.getElementById('errors');
    this.timerDisplay = document.getElementById('timer');
    this.progressBar = document.getElementById('progress');
    this.startBtn = document.getElementById('start-btn');
    this.resetBtn = document.getElementById('reset-btn');
    this.resultModal = document.getElementById('result-modal');
    this.restartBtn = document.getElementById('restart-btn');
    this.customTextArea = document.getElementById('custom-text-area');
    this.customTextInput = document.getElementById('custom-text-input');
    this.useCustomBtn = document.getElementById('use-custom-btn');
    this.clearCustomBtn = document.getElementById('clear-custom-btn');
    this.virtualKeyboard = document.getElementById('virtual-keyboard');
    this.keyboardToggleBtn = document.getElementById('keyboard-toggle-btn');
    
    // ОПРЕДЕЛЕНИЕ МОБИЛЬНОГО УСТРОЙСТВА
    this.isMobile = /Android|iPhone|iPad/i.test(navigator.userAgent);
    
    // ИНИЦИАЛИЗАЦИЯ ПЕРЕМЕННЫХ
    this.texts = {
      easy: [
        "Чайный пар поднимается к потолку, неся аромат мяты и тепла.",
        "Бабочка порхает над цветочной клумбой, касаясь лепестков крыльями.",
        "Вечерний закат окрашивает облака в оттенки розового и золотого.",
        "Старые половицы скрипят под ногами, рассказывая истории прошлых лет.",
        "Аромат свежеиспечённого хлеба наполняет всю кухню уютом.",
        "Ручей журчит среди камней, сплетая мелодию лесной тишины.",
        "Котёнок гоняется за солнечным зайчиком по ковру.",
        "Первый снег тихо ложится на ветви деревьев, укрывая мир белоснежной пеленой.",
        "Бабушка вяжет шарф, а спицы тихо постукивают в ритме воспоминаний.",
        "Листья шуршат под ногами осенней прогулки в парке.",
        "Свечи на столе мерцают, отбрасывая танцующие тени на стены.",
        "Малыш засыпает с книгой на груди, мечтая о приключениях.",
        "Волны накатывают на берег, убаюкивая песчаный пляж.",
        "Кофейная кружка согревает ладони холодным утром.",
        "Радуга раскинулась над городом после летнего дождя.",
        "Божья коровка ползёт по ладони, оставляя лёгкое щекотание.",
        "Звёзды мерцают на ночном небе, словно миллионы далёких огоньков.",
        "Дедушка чинит старые часы, возвращая им голос времени.",
        "Ветер колышет занавески, принося запах цветущей сирени.",
        "Маленький росток пробивается сквозь асфальт, неся надежду.",
        "Гамак качается между деревьями под лёгким ветерком.",
        "Дети лепят снеговика, смеясь над кривой улыбкой из камешков.",
        "Аромат хвои наполняет дом в преддверии праздника.",
        "Лягушки поют хором в тёплом пруду летним вечером.",
        "Старая книга пахнет пылью и мудростью ушедших эпох.",
        "Рассвет окрашивает небо в нежно-розовые тона над спящим городом.",
        "Малыш делает первые шаги, держась за пальцы мамы.",
        "Костёр потрескивает в лесу, отбрасывая тёплый свет на лица друзей.",
        "Лепестки сакуры кружатся в воздухе, как розовые снежинки.",
        "Дождевые капли рисуют узоры на оконном стекле.",
        "Пчела трудолюбиво собирает нектар с душистых цветов.",
        "Тёплый плед укрывает от осенней прохлады за чтением книги.",
        "Рыбак забрасывает удочку в тихую реку под утренней дымкой.",
        "Воздушный шарик уносится в небо, унося детские мечты.",
        "Морские волны оставляют на песке узоры из ракушек и водорослей.",
        "Старый дуб раскинул ветви, давая тень уставшим путникам.",
        "Аромат корицы и яблок наполняет дом в холодный день.",
        "Снегири клюют ягоды рябины на фоне белого снега.",
        "Луна отражается в озере, создавая серебряную дорожку.",
        "Маленький колокольчик на двери магазина звенит при каждом входе.",
        "Трава после дождя блестит миллионами капель-бриллиантов.",
        "Бабушка рассказывает сказку, а внуки слушают, затаив дыхание.",
        "Ветер гонит облака по небу, меняя картины каждую минуту.",
        "Солнечный зайчик бегает по стене, играя с котом.",
        "Первые подснежники пробиваются сквозь тающий снег.",
        "Чайная церемония в тишине утра приносит гармонию душе.",
        "Дети строят замок из песка у кромки воды.",
        "Запах мокрого асфальта после грозы будоражит чувства.",
        "Старая гитара в углу комнаты хранит мелодии прошлых вечеров.",
        "Божественные лучи солнца пробиваются сквозь туман в лесу.",
        "Малыш рисует красками на большом листе бумаги, создавая шедевр.",
        "Вечерний туман окутывает долину, превращая её в сказку.",
        "Капли росы украшают паутину, превращая её в жемчужное ожерелье.",
        "Пёс радостно бежит навстречу хозяину с виляющим хвостом.",
        "Закатное солнце превращает море в жидкое золото.",
        "Старые фотографии в альбоме оживают в воспоминаниях.",
        "Ветка сирени в простой вазе дарит весеннее настроение.",
        "Детский смех в бассейне разносится над летним двором.",
        "Тёплый хлеб с маслом — простое счастье утреннего завтрака.",
        "Сова мудро наблюдает с ветки за ночным лесом.",
        "Листопад кружит в вальсе под осенним ветром.",
        "Маленький фонарик освещает путь в тёмном коридоре.",
        "Аромат жареного кофе будит дом по утрам.",
        "Радужные мыльные пузыри уносятся в небо из детских рук.",
        "Скамейка в сквере хранит истории влюблённых и мечтателей.",
        "Лягушонок прыгает с кувшинки на кувшинку в пруду.",
        "Зимний вечер у камина с книгой — вершина уюта.",
        "Первые колокольчики звенят в траве весеннего луга.",
        "Морской бриз развевает волосы на прогулке вдоль берега.",
        "Старый маяк темноте указывает путь кораблям.",
        "Дети катаются на санках с горки, смеясь от восторга.",
        "Запах свежескошенной травы напоминает о лете.",
        "Бабочка садится на кончик пальца, доверяя человеку.",
        "Вечерние огни города мерцают, как земные звёзды.",
        "Малыш учится завязывать шнурки, преодолевая трудности.",
        "Ручей в горах поёт песню чистоты и свободы.",
        "Тёплый дождь барабанит по листьям банана на балконе.",
        "Старая скрипка извлекает из струн душу музыканта.",
        "Рассвет над горами окрашивает вершины в розовый цвет.",
        "Кошка свернулась клубочком на подушке, мурлыча во сне.",
        "Лепестки роз осыпаются на страницы открытой книги.",
        "Дети ловят светлячков в банку, создавая волшебный фонарь.",
        "Аромат ванили из духов матери будит детские воспоминания.",
        "Ветер гонит одуванчики, разнося их семена по свету.",
        "Старый диван помнит все семейные посиделки и разговоры.",
        "Лягушка прыгает в пруд, оставляя круги на воде.",
        "Зимние узоры на стекле рисует морозной ночью.",
        "Малыш кормит уток в пруду, радуясь их доверию.",
        "Тёплый песок между пальцами ног — ощущение лета.",
        "Звёздопад осыпает небо, исполняя заветные желания.",
        "Капли дождя собираются в луже, отражая небо.",
        "Бабушка печёт пироги, наполняя дом любовью и ароматом.",
        "Вечерняя прогулка под луной приносит умиротворение.",
        "Маленький росток фасоли тянется к солнечному свету.",
        "Дети строят шалаш из одеял и подушек в гостиной.",
        "Запах моря и водорослей на прибрежных камнях.",
        "Старая дверь скрипит, рассказывая историю дома.",
        "Радуга после дождя дарит надежду и улыбки.",
        "Малыш засыпает под колыбельную, напеваемую мамой.",
        "Тихий вечер с чашкой какао и любимой книгой — идеальное завершение дня.",
        "Кошка спит на мягком диване у окна. Её мурлыканье успокаивает.",
        "Дети играют в парке на свежем воздухе. Их смех разносится далеко.",
        "Книга - лучший друг человека. Она открывает новые миры и знания.",
        "Дождь стучит по крыше и создаёт уютную атмосферу в доме.",
        "Солнце светит ярко на небе голубом. Птицы поют свои весёлые песни."
      ],
      medium: [
        "Программирование — это искусство превращать идеи в работающие решения через логику и креативность.",
        "Искусственный интеллект учится у людей, но однажды может научить чему-то и нас.",
        "Музыка говорит там, где слова бессильны, находя отклик в самых глубоких уголках души.",
        "Путешествия учат нас принимать различия и находить общее в самых разных культурах.",
        "Здоровье — это не просто отсутствие болезней, а гармония тела, разума и духа.",
        "Алгоритмы окружают нас повсюду, незаметно направляя решения в цифровом мире.",
        "Творчество рождается на стыке дисциплины и свободы самовыражения.",
        "Горы учат смирению, а море — бесконечности возможностей.",
        "Каждое утро — это чистый лист кода, где можно написать что-то прекрасное.",
        "Медитация помогает услышать внутренний голос среди шума современного мира.",
        "Облака хранят данные, но не могут вместить глубину человеческих эмоций.",
        "Книга позволяет прожить тысячу жизней, не покидая любимого кресла.",
        "Физическая активность — это инвестиция в будущее собственного тела.",
        "Ошибка в коде — не провал, а возможность научиться чему-то новому.",
        "Природа — самый совершенный алгоритм, созданный без единой строчки программного кода.",
        "Сон — это ежедневная перезагрузка для мозга и тела.",
        "Изучение нового языка открывает двери в иные способы мышления.",
        "Цифровой минимализм помогает обрести ясность в мире информационного шума.",
        "Танец — это музыка, выраженная через движение тела без слов.",
        "Волонтёрство наполняет жизнь смыслом, даря тепло тем, кто в нём нуждается.",
        "Нейросети генерируют изображения, но не могут передать душу художника.",
        "Утренняя прогулка на рассвете заряжает энергией лучше любого кофеина.",
        "Чтение развивает эмпатию, позволяя проживать чужие переживания и взгляды.",
        "Вегетарианская диета может быть не только полезной, но и невероятно вкусной.",
        "Открытый исходный код — это философия доверия и коллективного развития.",
        "Тишина иногда говорит громче, чем самые громкие слова или звуки.",
        "Йога соединяет дыхание, тело и сознание в единый поток гармонии.",
        "Будущее принадлежит тем, кто умеет учиться на протяжении всей жизни.",
        "Цифровая фотография мгновенно запечатлевает моменты, но память хранит их по-другому.",
        "Садоводство учит терпению: хорошие плоды требуют времени и заботы.",
        "Кибербезопасность — невидимый щит, защищающий наше цифровое существование.",
        "Рисование помогает выразить то, что невозможно описать словами.",
        "Пешие прогулки без цели позволяют увидеть то, что упускаешь в спешке.",
        "Вода — простейшая молекула, но без неё невозможна никакая жизнь.",
        "Ментальное здоровье так же важно, как и физическое, требуя заботы и внимания.",
        "Блокчейн создаёт доверие без посредников через математическую прозрачность.",
        "Поэзия упаковывает вселенские истины в несколько тщательно подобранных слов.",
        "Холодный душ по утрам закаляет тело и дисциплинирует волю.",
        "Изучение истории помогает понять настоящее и предвидеть будущее.",
        "Умные часы отслеживают пульс, но не могут измерить биение влюблённого сердца.",
        "Волны океана напоминают: даже самая большая проблема — лишь капля в бескрайнем мире.",
        "Гибкость ума важнее объёма знаний в быстро меняющемся мире.",
        "Акварельные краски учат принимать неожиданные результаты как часть красоты.",
        "Семейные традиции — это живая связь между прошлым, настоящим и будущим.",
        "Облачные технологии стирают границы, позволяя работать из любой точки мира.",
        "Тепло человеческого прикосновения невозможно передать через самый быстрый интернет.",
        "Ранний подъём даёт драгоценные часы тишины перед началом суеты дня.",
        "Философия учит задавать правильные вопросы, а не искать простые ответы.",
        "Электромобили тихо меняют мир, оставляя за собой чистый воздух.",
        "Умение слушать — редкий дар, ценнее умения говорить.",
        "Квантовые компьютеры обещают решить задачи, недоступные сегодняшним машинам.",
        "Звёздное небо над головой напоминает о нашем месте во Вселенной.",
        "Сбалансированное питание — это не диета, а образ жизни и уважение к себе.",
        "Креативность часто рождается в ограничениях, а не в безграничной свободе.",
        "Бег трусцой учит ритму: ни слишком быстро, ни слишком медленно — свой темп.",
        "Виртуальная реальность создаёт новые миры, но реальный опыт остаётся бесценным.",
        "Дневниковые записи становятся зеркалом личностного роста спустя годы.",
        "Солнечная энергия дарит свет и тепло, не требуя ничего взамен.",
        "Эмпатия — это мост между людьми, построенный из понимания и сострадания.",
        "Автоматизация освобождает время для того, что действительно делает нас людьми.",
        "Лесной воздух наполнен ароматом хвои и свободы от городской суеты.",
        "Цифровой детокс раз в неделю помогает вернуть ясность мышления.",
        "Шахматы тренируют стратегическое мышление и терпение в принятии решений.",
        "Морская соль, ветер и волны — лучшее лекарство от городской усталости.",
        "Изучение астрономии скромно напоминает: мы часть чего-то гораздо большего.",
        "Тепло домашнего очага невозможно заменить никакими технологиями.",
        "Биохакинг тела начинается с простого: питьевой режим, сон и движение.",
        "Старые деревья хранят молчаливую мудрость веков в своих кольцах.",
        "Голосовые помощники отвечают на вопросы, но не заменят живого разговора.",
        "Умение прощать — это освобождение прежде всего для самого себя.",
        "Велосипедные прогулки позволяют увидеть мир в замедленном темпе.",
        "Нейропластичность мозга доказывает: никогда не поздно научиться чему-то новому.",
        "Аромат свежесваренного кофе по утрам — маленький ритуал радости.",
        "Открытые данные способствуют прозрачности и совместному решению глобальных проблем.",
        "Танец под дождём — спонтанный акт свободы и единения с природой.",
        "Минимализм в быту создаёт пространство для развития внутреннего мира.",
        "Криптовалюты меняют представление о деньгах, но не о ценности труда.",
        "Улыбка незнакомца может изменить весь ход дня без единого слова.",
        "Ферментированные продукты заботятся о микробиоме кишечника — нашем втором мозге.",
        "Звук дождя за окном — естественный белый шум для концентрации и покоя.",
        "Глубокое дыхание в стрессовой ситуации возвращает контроль над эмоциями.",
        "Солнечные закаты напоминают: каждый день достоин красивого завершения.",
        "Коллективный интеллект часто превосходит гениальность отдельной личности.",
        "Пение в душе освобождает эмоции и дарит мгновения чистой радости.",
        "Цифровая гигиена — регулярная чистка устройств и онлайн-присутствия.",
        "Горизонт всегда отдаляется, когда к нему приближаешься — как мечты и цели.",
        "Веганская кухня удивляет разнообразием вкусов и текстур из простых ингредиентов.",
        "Умение быть наедине с собой — важный навык в эпоху постоянной связи.",
        "Бумажные письма несут в себе тепло, которое не передать электронному сообщению.",
        "Сад на подоконнике — маленький островок природы в бетонном городе.",
        "Интернет соединил мир, но настоящая близость требует живого присутствия.",
        "Прогулка босиком по траве заземляет тело и успокаивает ум.",
        "Непрерывное обучение — единственная гарантия актуальности в цифровую эпоху.",
        "Тепло рук, лепящих глину, передаётся самому материалу, оживляя его.",
        "Время, проведённое без экрана, возвращается в виде ясности и вдохновения.",
        "Экологичный образ жизни — не жертва, а осознанный выбор будущего.",
        "Музыка в наушниках создаёт пузырь уюта даже в шумном метро.",
        "Сила привычки формирует нашу жизнь постепенно, день за днём.",
        "Звёзды на ночном небе — древние маяки, ведущие путешественников домой.",
        "Технологии должны служить человеку, а не наоборот.",
        "Программирование требует терпения и внимания к деталям. Каждая строка кода имеет значение.",
        "Искусственный интеллект меняет мир вокруг нас. Его возможности постоянно растут.",
        "Музыка обладает удивительной силой влиять на настроение и эмоции человека.",
        "Путешествия расширяют кругозор и позволяют узнать много нового о мире.",
        "Здоровый образ жизни включает правильное питание, спорт и полноценный сон."
      ],
      hard: [
        "Квантовые вычисления представляют собой революционный подход к обработке информации, использующий принципы квантовой механики.",
        "Философские концепции бытия и сознания формировались на протяжении всей истории человеческой мысли.",
        "Биоразнообразие планеты находится под угрозой из-за деятельности человека и изменения климата.",
        "Искусственные нейронные сети способны обучаться на больших объёмах данных и принимать сложные решения.",
        "Космологические исследования помогают нам понять происхождение и эволюцию Вселенной.",
        "Генетическая инженерия открывает новые горизонты в лечении наследственных заболеваний и модификации организмов.",
        "Сознание остаётся одной из величайших загадок науки, несмотря на прогресс в нейробиологии и когнитивных исследованиях.",
        "Антропогенное воздействие на климатическую систему Земли приводит к ускорению глобального потепления и экстремальных погодных явлений.",
        "Квантовая запутанность демонстрирует нелокальные корреляции между частицами, нарушающие классические представления о причинности.",
        "Эволюционная теория объясняет разнообразие жизни на Земле через механизмы естественного отбора и генетической изменчивости.",
        "Нейропластичность мозга позволяет нервной системе адаптироваться к новым условиям и восстанавливаться после повреждений.",
        "Тёмная материя и тёмная энергия составляют около 95% массы-энергии Вселенной, оставаясь при этом недоступными прямому наблюдению.",
        "Синтетическая биология стремится создавать искусственные биологические системы с заранее заданными функциями.",
        "Феноменология сознания исследует структуру субъективного опыта и его отношение к объективной реальности.",
        "Устойчивое развитие требует баланса между экономическим ростом, социальной справедливостью и экологической стабильностью.",
        "Квантовая криптография обеспечивает теоретически неуязвимую защиту информации на основе законов квантовой физики.",
        "Эмерджентные свойства сложных систем проявляются на уровне целого и не могут быть сведены к свойствам отдельных компонентов.",
        "Биосфера Земли представляет собой саморегулирующуюся систему, поддерживающую условия для существования жизни.",
        "Глубокое обучение достигает впечатляющих результатов в распознавании образов благодаря многослойной архитектуре нейронных сетей.",
        "Релятивистские эффекты становятся значимыми при движении объектов со скоростями, близкими к скорости света.",
        "Эпигенетические механизмы регулируют экспрессию генов без изменения последовательности ДНК, передаваясь иногда через поколения.",
        "Метафизические категории пространства и времени трансформировались от абсолютных ньютоновских концепций к относительности Эйнштейна.",
        "Шестое массовое вымирание, вызванное деятельностью человека, угрожает стабильности экосистем по всему миру.",
        "Обратное распространение ошибки является ключевым алгоритмом обучения многослойных перцептронов в искусственных нейросетях.",
        "Инфляционная модель ранней Вселенной объясняет её однородность и плоскостность через экспоненциальное расширение.",
        "Квантовые биты (кубиты) могут находиться в суперпозиции состояний, что обеспечивает экспоненциальный рост вычислительной мощности.",
        "Проблема других умов остаётся философской дилеммой о возможности достоверного знания о сознании иных существ.",
        "Тропические леса Амазонки выполняют функцию «лёгких планеты», поглощая углекислый газ и производя кислород.",
        "Трансформеры и механизмы внимания революционизировали обработку естественного языка в современных языковых моделях.",
        "Чёрные дыры искривляют пространство-время настолько сильно, что даже свет не может покинуть их пределы за горизонтом событий.",
        "Синергетика изучает самоорганизацию и возникновение порядка в открытых нелинейных системах далёких от равновесия.",
        "Экзистенциальные вопросы о смысле жизни и свободе воли продолжают волновать философскую мысль на протяжении веков.",
        "Коралловые рифы, несмотря на малую площадь, поддерживают более четверти всех морских видов, находясь под угрозой обесцвечивания.",
        "Генеративно-состязательные сети состоят из двух нейросетей, обучающихся в противоборстве для создания реалистичных данных.",
        "Космический микроволновый фон представляет собой реликтовое излучение, сохранившееся со времён Большого взрыва.",
        "Квантовая декогеренция объясняет переход от квантового поведения к классическому при взаимодействии системы с окружением.",
        "Философия науки анализирует методологические основания научного познания и критерии демаркации науки от псевдонауки.",
        "Пермско-триасовое вымирание 252 миллиона лет назад уничтожило до 96% морских видов, став самым масштабным в истории Земли.",
        "Метаобучение позволяет моделям искусственного интеллекта быстро адаптироваться к новым задачам с минимальным количеством примеров.",
        "Теория струн пытается объединить квантовую механику и общую теорию относительности через вибрации одномерных объектов.",
        "Нейрофеноменология объединяет нейронаучные данные с феноменологическим анализом первого-лица субъективного опыта.",
        "Арктические льды тают с ускорением, что влияет на глобальные климатические паттерны и уровень Мирового океана.",
        "Рекуррентные нейронные сети обладают памятью состояния, что делает их эффективными для обработки последовательных данных.",
        "Мультивселенная — гипотетическая совокупность множества вселенных, существующих параллельно с нашей.",
        "Квантовая телепортация передаёт квантовое состояние частицы на расстояние без физического перемещения самой частицы.",
        "Дуализм Декарта разделял реальность на материальную субстанцию и нематериальную мыслящую субстанцию.",
        "Пластиковая загрязнённость океанов создаёт «мусорные острова» и проникает в пищевые цепи морских экосистем.",
        "Архитектура BERT использует двунаправленное обучение для глубокого понимания контекста в естественном языке.",
        "Тёмная энергия, ответственная за ускоренное расширение Вселенной, остаётся одной из главных загадок современной космологии.",
        "Квантовые алгоритмы Шора и Гровера демонстрируют теоретическое превосходство квантовых компьютеров над классическими.",
        "Проблема сознания «трудная проблема» Дэвида Чалмерса касается объяснения субъективного опыта через физические процессы.",
        "Озоновый слой стратосферы защищает живые организмы от вредного ультрафиолетового излучения Солнца.",
        "Свёрточные нейронные сети автоматически извлекают иерархические признаки из изображений через фильтры свёртки.",
        "Реликтовые гравитационные волны могут содержать информацию о самых ранних моментах существования Вселенной.",
        "Квантовая интерференция проявляется в наложении вероятностных амплитуд, создавая характерные паттерны в экспериментах.",
        "Этика искусственного интеллекта рассматривает вопросы ответственности, предвзятости и автономии интеллектуальных систем.",
        "Массовое вымирание голоценовой эпохи, вызванное человеком, угрожает биосферной устойчивости планеты.",
        "Архитектура трансформеров заменила рекуррентные связи механизмом самовнимания для параллельной обработки последовательностей.",
        "Космологическая постоянная Эйнштейна, первоначально отвергнутая, теперь интерпретируется как проявление тёмной энергии.",
        "Суперпозиция квантовых состояний позволяет кубиту одновременно представлять ноль и единицу до момента измерения.",
        "Философия сознания исследует связь между мозговой активностью и субъективными переживаниями феноменального опыта.",
        "Деградация почв вследствие интенсивного земледелия угрожает продовольственной безопасности будущих поколений.",
        "Метафора «чёрного ящика» применима к сложным нейросетям, внутренние процессы которых трудно интерпретировать.",
        "Планковская эпоха первых 10^-43 секунд после Большого взрыва остаётся недоступной для современных физических теорий.",
        "Квантовая ошибка коррекции необходима для защиты хрупких квантовых состояний от декогеренции в реальных системах.",
        "Эмерджентный материализм предполагает, что сознание возникает как новое свойство сложных нейронных систем.",
        "Кислотность океанов возрастает из-за поглощения избыточного углекислого газа, угрожая кальцифицирующим организмам.",
        "Нейроморфные вычисления имитируют архитектуру биологического мозга для повышения энергоэффективности обработки информации.",
        "Сингулярность в центре чёрной дыры представляет точку, где законы физики перестают действовать в привычном виде.",
        "Квантовая теория поля объединяет квантовую механику и специальную теорию относительности для описания элементарных частиц.",
        "Философский зомби — мысленный эксперимент о существе, идентичном человеку физически, но лишённом сознания.",
        "Таяние вечной мерзлоты высвобождает метан, усиливающий парниковый эффект в опасном положительном обратном цикле.",
        "Аугментация данных искусственно расширяет обучающие наборы для повышения обобщающей способности моделей ИИ.",
        "Космологический принцип утверждает однородность и изотропность Вселенной в достаточно больших масштабах.",
        "Квантовые повторители необходимы для создания глобальных квантовых сетей передачи информации на большие расстояния.",
        "Интенциональность сознания — его способность быть направленным на объекты — остаётся ключевой проблемой философии разума.",
        "Опустынивание засушливых регионов ускоряется под воздействием изменения климата и нерационального землепользования.",
        "Обучение с подкреплением позволяет агентам оптимизировать поведение через взаимодействие со средой и получение вознаграждений.",
        "Реликтовое излучение содержит крошечные флуктуации температуры, отражающие начальные условия формирования галактик.",
        "Квантовая томография восстанавливает полное описание квантового состояния через серию измерений идентично приготовленных систем.",
        "Дуализм свойств света как волны и частицы лежит в основе корпускулярно-волнового дуализма в квантовой механике.",
        "Фрагментация местообитаний изолирует популяции видов, снижая генетическое разнообразие и повышая риск вымирания.",
        "Нейросимволический ИИ стремится объединить преимущества нейросетей и символьных рассуждений для создания более разумных систем.",
        "Инфляционная теория предсказывает существование первичных гравитационных волн, оставивших след в поляризации реликтового излучения.",
        "Квантовые точки — наноструктуры с квантовым ограничением — обладают уникальными оптическими свойствами для применения в дисплеях.",
        "Философия математики исследует онтологический статус математических объектов и природу математической истины.",
        "Гипоксические зоны в океанах расширяются из-за потепления воды и эвтрофикации, создавая «мёртвые зоны» для морской жизни.",
        "Модельное обучение с учителем требует размеченных данных для установления соответствия между входами и желаемыми выходами.",
        "Теория петлевой квантовой гравитации квантуем пространство-время как дискретную структуру из взаимосвязанных петель.",
        "Квантовая запутанность Эйнштейна-Подольского-Розена демонстрирует нелокальные корреляции, которые он называл «жутким действием».",
        "Феноменологическая редукция Хуссерля направлена на выявление сущностных структур сознания через отстранение от естественной установки.",
        "Антропоцен — геологическая эпоха, в которой деятельность человека стала определяющим фактором изменений на планете.",
        "Архитектура ResNet с остаточными связями позволила обучать чрезвычайно глубокие нейросети без проблемы затухающих градиентов.",
        "Космологическая инфляция решает горизонтальную и плоскостную проблемы стандартной модели Большого взрыва.",
        "Квантовые симуляторы используют контролируемые квантовые системы для моделирования сложных квантовых явлений, недоступных классическим компьютерам.",
        "Квантовые вычисления представляют собой революционный подход к обработке информации, использующий принципы квантовой механики.",
        "Философские концепции бытия и сознания формировались на протяжении всей истории человеческой мысли.",
        "Биоразнообразие планеты находится под угрозой из-за деятельности человека и изменения климата.",
        "Искусственные нейронные сети способны обучаться на больших объёмах данных и принимать сложные решения.",
        "Космологические исследования помогают нам понять происхождение и эволюцию Вселенной."
      ]
    };
    
    this.keyMap = {
      '`': '`', '1': '1', '2': '2', '3': '3', '4': '4', '5': '5', '6': '6', '7': '7', '8': '8', '9': '9', '0': '0',
      '-': '-', '=': '=', '\\': '\\',
      'Backspace': '⌫',
      'Tab': '⇥',
      'CapsLock': '⇪',
      'Shift': '⇧',
      'Enter': '↵',
      'Control': 'Ctrl',
      'Meta': '⊞',
      'Alt': 'Alt',
      ' ': '',
      'й': 'й', 'ц': 'ц', 'у': 'у', 'к': 'к', 'е': 'е', 'н': 'н', 'г': 'г', 'ш': 'ш', 'щ': 'щ', 'з': 'з', 'х': 'х', 'ъ': 'ъ',
      'ф': 'ф', 'ы': 'ы', 'в': 'в', 'а': 'а', 'п': 'п', 'р': 'р', 'о': 'о', 'л': 'л', 'д': 'д', 'ж': 'ж', 'э': 'э',
      'я': 'я', 'ч': 'ч', 'с': 'с', 'м': 'м', 'и': 'и', 'т': 'т', 'ь': 'ь', 'б': 'б', 'ю': 'ю', '.': '.',
      'Й': 'й', 'Ц': 'ц', 'У': 'у', 'К': 'к', 'Е': 'е', 'Н': 'н', 'Г': 'г', 'Ш': 'ш', 'Щ': 'щ', 'З': 'з', 'Х': 'х', 'Ъ': 'ъ',
      'Ф': 'ф', 'Ы': 'ы', 'В': 'в', 'А': 'а', 'П': 'п', 'Р': 'р', 'О': 'о', 'Л': 'л', 'Д': 'д', 'Ж': 'ж', 'Э': 'э',
      'Я': 'я', 'Ч': 'ч', 'С': 'с', 'М': 'м', 'И': 'и', 'Т': 'т', 'Ь': 'ь', 'Б': 'б', 'Ю': 'ю'
    };
    
    this.currentText = '';
    this.currentIndex = 0;
    this.correctChars = 0;
    this.totalChars = 0;
    this.errors = 0;
    this.startTime = 0;
    this.timer = null;
    this.isTyping = false;
    this.difficulty = 'easy';
    this.mode = 'random';
    this.isKeyboardVisible = true;
    
    // МОБИЛЬНАЯ ОПТИМИЗАЦИЯ
    if (this.isMobile) {
      this.isKeyboardVisible = false;
    }
    
    this.initEventListeners();
    this.generateText();
    this.updateKeyboardVisibility();
  }
  
  initEventListeners() {
    this.startBtn.addEventListener('click', () => this.startTyping());
    this.resetBtn.addEventListener('click', () => this.resetTyping());
    this.restartBtn.addEventListener('click', () => {
      this.resultModal.style.display = 'none';
      this.resetTyping();
    });
    this.typingInput.addEventListener('input', (e) => this.handleInput(e));
    this.typingInput.addEventListener('keydown', (e) => this.handleKeyDown(e));
    this.typingInput.addEventListener('keyup', (e) => this.handleKeyUp(e));
    
    // Mode selection
    document.querySelectorAll('.mode-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
        e.target.classList.add('active');
        this.mode = e.target.dataset.mode;
        if (this.mode === 'custom') {
          this.customTextArea.style.display = 'block';
        } else {
          this.customTextArea.style.display = 'none';
        }
        if (!this.isTyping) {
          this.generateText();
        }
      });
    });
    
    // Difficulty selection
    document.querySelectorAll('.difficulty-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
        e.target.classList.add('active');
        this.difficulty = e.target.dataset.difficulty;
        if (!this.isTyping && this.mode === 'random') {
          this.generateText();
        }
      });
    });
    
    // Custom text buttons
    this.useCustomBtn.addEventListener('click', () => {
      if (this.customTextInput.value.trim() === '') {
        alert('Пожалуйста, введите текст для тренировки!');
        return;
      }
      if (!this.isTyping) {
        this.generateText();
      }
    });
    
    this.clearCustomBtn.addEventListener('click', () => {
      this.customTextInput.value = '';
    });
    
    // Keyboard toggle
    this.keyboardToggleBtn.addEventListener('click', () => {
      this.isKeyboardVisible = !this.isKeyboardVisible;
      this.updateKeyboardVisibility();
    });
    
    // Focus input on click anywhere in container
    document.querySelector('.container').addEventListener('click', () => {
      if (this.isTyping) {
        this.typingInput.focus();
      }
    });
  }
  
  stopTimer() {
    if (this.timer) {
      clearInterval(this.timer);
      this.timer = null;
    }
  }
  
  startTimer() {
    this.stopTimer();
    this.timer = setInterval(() => {
      const elapsed = Math.floor((Date.now() - this.startTime) / 1000);
      this.timerDisplay.textContent = `${elapsed}s`;
    }, 1000);
  }
  
  updateKeyboardVisibility() {
    this.virtualKeyboard.style.display = this.isKeyboardVisible ? 'flex' : 'none';
    this.keyboardToggleBtn.textContent = this.isKeyboardVisible ? 'Скрыть клавиатуру' : 'Показать клавиатуру';
  }
  
  generateText() {
    if (this.mode === 'custom') {
      const customText = this.customTextInput.value.trim();
      if (customText === '') {
        this.customTextInput.value = "Кошка спит на мягком диване у окна. Её мурлыканье успокаивает.";
        this.currentText = this.customTextInput.value;
      } else {
        this.currentText = customText;
      }
    } else {
      const texts = this.texts[this.difficulty];
      this.currentText = texts[Math.floor(Math.random() * texts.length)];
    }
    
    this.currentIndex = 0;
    this.correctChars = 0;
    this.totalChars = 0;
    this.errors = 0;
    
    this.textDisplay.innerHTML = '';
    for (let i = 0; i < this.currentText.length; i++) {
      const charSpan = document.createElement('span');
      charSpan.textContent = this.currentText[i];
      if (i === 0) charSpan.classList.add('current');
      this.textDisplay.appendChild(charSpan);
    }
    
    this.updateStats();
    this.typingInput.value = '';
    this.typingInput.disabled = true;
    this.typingInput.blur();
    this.progressBar.style.width = '0%';
    
    this.resetKeyboardHighlights();
  }
  
  resetKeyboardHighlights() {
    document.querySelectorAll('.key').forEach(key => {
      key.className = key.textContent.trim() === '' ? 'key key-space' : 'key';
      const text = key.textContent.trim();
      if (text === '⇥') key.className = 'key key-tab';
      if (text === '⇪') key.className = 'key key-caps';
	  if (text === 'Aly') key.className = 'key key-aly';
	  if (text === '↵') key.className = 'key key-enter2';
      if (text === '↵ Enter') key.className = 'key key-enter';
      if (text === '⇧') key.className = 'key key-shiftl';
	  if (text === '⇧ Shift') key.className = 'key key-shiftr';
      if (text === '⌫') key.className = 'key key-backspace';
      if (text === 'Ctrl') key.className = 'key key-ctrl';
      if (text === '⊞') key.className = 'key key-win';
      if (text === 'Alt') key.className = 'key key-alt';
    });
  }
  
  highlightKey(keyChar, type = 'current') {
    // Сбросить все подсветки
    document.querySelectorAll('.key').forEach(key => {
      key.classList.remove('current', 'correct', 'incorrect', 'pressed');
    });
    
    // Обработка для клавиш с разной шириной
    const isUpperCase = keyChar !== keyChar.toLowerCase() && keyChar === keyChar.toUpperCase();
    const baseChar = isUpperCase ? keyChar.toLowerCase() : keyChar;
    
    if (isUpperCase) {
      document.querySelectorAll('.key').forEach(key => {
        if (key.textContent.trim() === '⇧') {
          key.classList.add(type);
        }
      });
    }
    
    // Обработка основной клавиши
    const normalizedKey = baseChar.toLowerCase();
    const keyName = this.keyMap[normalizedKey] || this.keyMap[baseChar] || baseChar;
    
    document.querySelectorAll('.key').forEach(key => {
      const keyText = key.textContent.trim();
      
      // Обработка пробела
      if (baseChar === ' ' && key.classList.contains('key-space')) {
        key.classList.add(type);
        return;
      }
      
      // Обработка обычных клавиш
      if (keyText === keyName) {
        key.classList.add(type);
      }
    });
  }
  
  startTyping() {
    if (this.isTyping) return;
    this.isTyping = true;
    this.typingInput.disabled = false;
    this.typingInput.value = '';
    this.typingInput.focus();
    this.startTime = Date.now();
    this.startTimer();
    
    // Сбросить подсветку
    document.querySelectorAll('#text-display span').forEach((span, index) => {
      span.className = '';
      if (index === 0) span.classList.add('current');
    });
    
    if (this.currentText.length > 0) {
      this.highlightKey(this.currentText[0], 'current');
    }
  }
  
  handleInput(e) {
    const inputChar = e.data;
    const currentChar = this.currentText[this.currentIndex];
    
    if (inputChar === null) return;
    
    this.totalChars++;
    
    const spans = this.textDisplay.querySelectorAll('span');
    if (spans[this.currentIndex]) {
      const isCorrect = inputChar === currentChar;
      
      if (isCorrect) {
        spans[this.currentIndex].classList.add('correct');
        this.correctChars++;
        this.highlightKey(currentChar, 'correct');
      } else {
        spans[this.currentIndex].classList.add('incorrect');
        this.errors++;
        this.highlightKey(inputChar, 'incorrect');
      }
      
      spans[this.currentIndex].classList.remove('current');
      this.currentIndex++;
      
      if (this.currentIndex < spans.length) {
        spans[this.currentIndex].classList.add('current');
        this.highlightKey(this.currentText[this.currentIndex], 'current');
      }
      
      const progress = (this.currentIndex / this.currentText.length) * 100;
      this.progressBar.style.width = `${progress}%`;
      
      if (this.currentIndex >= this.currentText.length) {
        this.finishTyping();
      }
    }
    
    this.updateStats();
    this.typingInput.value = '';
  }
  
  handleKeyDown(e) {
    let keyToShow = e.key;
    if (e.key === ' ') keyToShow = ' ';
    if (e.key === 'Backspace') keyToShow = 'Backspace';
    if (e.key === 'Enter') keyToShow = 'Enter';
    if (e.key === 'Tab') keyToShow = 'Tab';
    if (e.key === 'CapsLock') keyToShow = 'CapsLock';
    if (e.key === 'Shift') keyToShow = 'Shift';
    if (e.key === 'Control') keyToShow = 'Control';
    if (e.key === 'Meta') keyToShow = 'Meta';
    if (e.key === 'Alt') keyToShow = 'Alt';
    
    const keyName = this.keyMap[keyToShow] || keyToShow;
    
    document.querySelectorAll('.key').forEach(key => {
      if (key.textContent.trim() === keyName || (keyName === '' && key.classList.contains('key-space'))) {
        key.classList.add('pressed');
      }
    });
    
    if (e.key === 'Backspace' && this.currentIndex > 0 && this.isTyping) {
      e.preventDefault();
      this.currentIndex--;
      
      const spans = this.textDisplay.querySelectorAll('span');
      spans[this.currentIndex].className = '';
      
      if (this.currentIndex > 0) {
        spans[this.currentIndex - 1].classList.add('current');
        this.highlightKey(this.currentText[this.currentIndex - 1], 'current');
      }
      
      this.totalChars--;
      
      if (spans[this.currentIndex].classList.contains('correct')) {
        this.correctChars--;
      } else if (spans[this.currentIndex].classList.contains('incorrect')) {
        this.errors--;
      }
      
      this.updateStats();
    }
  }
  
  handleKeyUp(e) {
    let keyToShow = e.key;
    if (e.key === ' ') keyToShow = ' ';
    if (e.key === 'Backspace') keyToShow = 'Backspace';
    if (e.key === 'Enter') keyToShow = 'Enter';
    if (e.key === 'Tab') keyToShow = 'Tab';
    if (e.key === 'CapsLock') keyToShow = 'CapsLock';
    if (e.key === 'Shift') keyToShow = 'Shift';
    if (e.key === 'Control') keyToShow = 'Control';
    if (e.key === 'Meta') keyToShow = 'Meta';
    if (e.key === 'Alt') keyToShow = 'Alt';
    
    const keyName = this.keyMap[keyToShow] || keyToShow;
    
    document.querySelectorAll('.key').forEach(key => {
      if (key.textContent.trim() === keyName || (keyName === '' && key.classList.contains('key-space'))) {
        key.classList.remove('pressed');
      }
    });
  }
  
  calculateCPM() {
    if (!this.startTime || this.correctChars === 0) return 0;
    const elapsedSeconds = (Date.now() - this.startTime) / 1000;
    if (elapsedSeconds < 5) return 0;
    return Math.round((this.correctChars / elapsedSeconds) * 60);
  }
  
  calculateAccuracy() {
    if (this.totalChars === 0) return 100;
    return Math.round((this.correctChars / this.totalChars) * 100);
  }
  
  updateStats() {
    this.cpmDisplay.textContent = this.calculateCPM();
    this.accuracyDisplay.textContent = `${this.calculateAccuracy()}%`;
    this.errorsDisplay.textContent = this.errors;
  }
  
  finishTyping() {
    this.stopTimer();
    this.isTyping = false;
    this.typingInput.disabled = true;
    
    // СОХРАНЕНИЕ СТАТИСТИКИ В localStorage
    const cpm = this.calculateCPM();
    const bestCPM = Math.max(cpm, parseInt(localStorage.getItem('bestCPM') || '0'));
    localStorage.setItem('bestCPM', bestCPM.toString());
    localStorage.setItem('lastSession', Date.now().toString());
    
    document.getElementById('result-cpm').textContent = cpm;
    document.getElementById('result-accuracy').textContent = `${this.calculateAccuracy()}%`;
    document.getElementById('result-errors').textContent = this.errors;
    document.getElementById('result-time').textContent = this.timerDisplay.textContent;
    
    this.resultModal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
    this.resultModal.querySelector('.btn').focus();
  }
  
  resetTyping() {
    this.stopTimer();
    this.isTyping = false;
    this.timerDisplay.textContent = '0s';
    this.generateText();
    document.body.style.overflow = '';
  }
}

document.addEventListener('DOMContentLoaded', () => {
  window.typingTrainer = new TypingTrainer();
});
</script>
</body>
</html>
